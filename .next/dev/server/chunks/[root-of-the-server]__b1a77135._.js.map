{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/admin-icts/LatestProject/src/app/dashboard/requests/api/route.ts"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport { NextResponse } from \"next/server\";\nimport { RequestType } from \"@/types/request\";\n\nconst filePath = path.join(process.cwd(), \"src\", \"app\", \"data\", \"requests.txt\");\n\n/* ---------------- HELPERS ---------------- */\nconst readRequests = (): RequestType[] => {\n  if (!fs.existsSync(filePath)) return [];\n  const data = fs.readFileSync(filePath, \"utf-8\");\n  if (!data || data.trim() === \"\") return [];\n  try {\n    return JSON.parse(data) as RequestType[];\n  } catch {\n    return [];\n  }\n};\n\nconst writeRequests = (requests: RequestType[]) => {\n  fs.writeFileSync(filePath, JSON.stringify(requests, null, 2));\n};\n\n/* ---------------- GET (excludes soft-deleted) ---------------- */\nexport async function GET() {\n  const requests = readRequests();\n  // Filter out deleted requests (where deletedAt is set)\n  const activeRequests = requests.filter((r) => !r.deletedAt);\n  return NextResponse.json(activeRequests);\n}\n\n/* ---------------- POST (CREATE) ---------------- */\nexport async function POST(request: Request) {\n  let incomingRequest: Omit<RequestType, \"id\">;\n\n  // Safe JSON parse\n  try {\n    incomingRequest = await request.json();\n  } catch (err) {\n    console.error(\"Failed to parse JSON:\", err);\n    return NextResponse.json(\n      { success: false, message: \"Invalid JSON in request body\" },\n      { status: 400 }\n    );\n  }\n\n  const { category, title, description, ...optionalFields } = incomingRequest;\n\n  // Validate required fields\n  if (!category || !title || !description) {\n    return NextResponse.json(\n      { success: false, message: \"Missing required fields\" },\n      { status: 400 }\n    );\n  }\n\n  // Safe file write with type coercion\n  try {\n    const requests = readRequests();\n    const id = Date.now(); // unique ID\n\n    const newRequest: RequestType = {\n      id,\n      category: String(category),\n      title: String(title),\n      description: String(description),\n      // Convert all optional fields to string to satisfy RequestType\n      ...Object.fromEntries(\n        Object.entries(optionalFields).map(([k, v]) => [k, String(v)])\n      ),\n    };\n\n    requests.push(newRequest);\n    writeRequests(requests);\n\n    return NextResponse.json({ success: true, request: newRequest });\n  } catch (err) {\n    console.error(\"Failed to write request:\", err);\n    return NextResponse.json(\n      { success: false, message: \"Server error\" },\n      { status: 500 }\n    );\n  }\n}\n\n/* ---------------- DELETE (SOFT DELETE) ---------------- */\nexport async function DELETE(request: Request) {\n  const { id }: { id: number } = await request.json();\n  let requests = readRequests();\n\n  let found = false;\n  requests = requests.map((r) => {\n    if (r.id === id) {\n      found = true;\n      // Soft delete: mark with deletedAt timestamp instead of removing\n      return {\n        ...r,\n        deletedAt: new Date().toISOString(),\n      };\n    }\n    return r;\n  });\n\n  if (!found) {\n    return NextResponse.json(\n      { success: false, message: \"Request not found\" },\n      { status: 404 }\n    );\n  }\n\n  writeRequests(requests);\n  return NextResponse.json({ success: true });\n}\n\n/* ---------------- PUT (UPDATE) ---------------- */\nexport async function PUT(request: Request) {\n  const updatedRequest: RequestType = await request.json();\n\n  if (\n    !updatedRequest.id ||\n    !updatedRequest.category ||\n    !updatedRequest.title ||\n    !updatedRequest.description\n  ) {\n    return NextResponse.json(\n      { success: false, message: \"Missing required fields\" },\n      { status: 400 }\n    );\n  }\n\n  let requests = readRequests();\n  let found = false;\n\n  requests = requests.map((r) => {\n    if (r.id === updatedRequest.id) {\n      found = true;\n      const { id, category, title, description, ...rest } = updatedRequest;\n      return { ...r, id, category, title, description, ...rest };\n    }\n    return r;\n  });\n\n  if (!found) {\n    return NextResponse.json(\n      { success: false, message: \"Request not found\" },\n      { status: 404 }\n    );\n  }\n\n  writeRequests(requests);\n  return NextResponse.json({ success: true });\n}\n"],"names":[],"mappings":"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"}}]
}