{"version":3,"sources":["../../../../src/lib/validation.ts","../../../../src/app/dashboard/create-request/page.tsx"],"sourcesContent":["/**\n * Field validation utilities for form inputs\n */\n\nexport const getFieldInputType = (fieldName: string): string => {\n  const lowerField = fieldName.toLowerCase();\n\n  if (lowerField.includes(\"phone\") || lowerField.includes(\"contact\")) {\n    return \"tel\";\n  }\n  if (lowerField.includes(\"email\")) {\n    return \"email\";\n  }\n  if (lowerField.includes(\"date\")) {\n    return \"date\";\n  }\n  if (lowerField.includes(\"ip\")) {\n    return \"text\";\n  }\n  return \"text\";\n};\n\nexport const getFieldPattern = (fieldName: string): string | undefined => {\n  const lowerField = fieldName.toLowerCase();\n\n  if (lowerField.includes(\"phone\") || lowerField.includes(\"contact\")) {\n    return \"[0-9\\\\-()\\\\+ ]*\";\n  }\n  return undefined;\n};\n\n/**\n * Validate field input based on field type\n */\nexport const validateFieldInput = (\n  fieldName: string,\n  value: string\n): { valid: boolean; error?: string } => {\n  if (!value) {\n    return { valid: true }; // Empty is valid for optional fields\n  }\n\n  const lowerField = fieldName.toLowerCase();\n\n  // Phone/Contact validation - only numbers, dashes, parentheses, plus, spaces\n  if (lowerField.includes(\"phone\") || lowerField.includes(\"contact\")) {\n    const phoneRegex = /^[0-9\\-()+ ]*$/;\n    if (!phoneRegex.test(value)) {\n      return {\n        valid: false,\n        error:\n          \"Phone number can only contain numbers, dashes, parentheses, plus sign, and spaces\",\n      };\n    }\n    return { valid: true };\n  }\n\n  // Email validation\n  if (lowerField.includes(\"email\")) {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(value)) {\n      return { valid: false, error: \"Please enter a valid email address\" };\n    }\n    return { valid: true };\n  }\n\n  // Title - should not be empty if required\n  if (lowerField.includes(\"title\")) {\n    if (value.trim().length === 0) {\n      return { valid: false, error: \"Title cannot be empty\" };\n    }\n    if (value.length > 100) {\n      return { valid: false, error: \"Title must be 100 characters or less\" };\n    }\n    return { valid: true };\n  }\n\n  // Description - should not be empty if required\n  if (lowerField.includes(\"description\")) {\n    if (value.trim().length === 0) {\n      return { valid: false, error: \"Description cannot be empty\" };\n    }\n    if (value.length > 500) {\n      return { valid: false, error: \"Description must be 500 characters or less\" };\n    }\n    return { valid: true };\n  }\n\n  // Default validation\n  return { valid: true };\n};\n\n/**\n * Validate entire form data\n */\nexport const validateFormData = (\n  data: Record<string, string>\n): { valid: boolean; errors: Record<string, string> } => {\n  const errors: Record<string, string> = {};\n\n  Object.entries(data).forEach(([key, value]) => {\n    const result = validateFieldInput(key, value);\n    if (!result.valid && result.error) {\n      errors[key] = result.error;\n    }\n  });\n\n  return {\n    valid: Object.keys(errors).length === 0,\n    errors,\n  };\n};\n\n/**\n * Only allow numeric input for phone numbers\n */\nexport const filterPhoneInput = (value: string): string => {\n  // Allow numbers, dashes, parentheses, plus sign, and spaces\n  return value.replace(/[^0-9\\-()+ ]/g, \"\");\n};\n","\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { RequestType } from \"@/types/request\";\nimport {\n  getFieldInputType,\n  getFieldPattern,\n  validateFieldInput,\n  filterPhoneInput,\n} from \"@/lib/validation\";\nimport { addToast } from \"@/lib/toast\";\n\ntype Category =\n  | \"\"\n  | \"network\"\n  | \"carpentry\"\n  | \"hardware\"\n  | \"vehicle\"\n  | \"supplies\";\n\nexport default function CreateRequestPage() {\n  const [category, setCategory] = useState<Category>(\"\");\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const router = useRouter();\n\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    const form = new FormData(e.currentTarget);\n\n    // Collect and validate data\n    const formData: Record<string, string> = {};\n    const newErrors: Record<string, string> = {};\n\n    form.forEach((value, key) => {\n      if (value !== null) {\n        const strValue = value.toString();\n        formData[key] = strValue;\n\n        // Validate each field\n        const validation = validateFieldInput(key, strValue);\n        if (!validation.valid && validation.error) {\n          newErrors[key] = validation.error;\n        }\n      }\n    });\n\n    // Check for validation errors\n    if (Object.keys(newErrors).length > 0) {\n      setErrors(newErrors);\n      addToast(\"Please fix the validation errors\", \"error\");\n      return;\n    }\n\n    // Clear errors if validation passed\n    setErrors({});\n\n    const data: Omit<RequestType, \"id\"> = formData;\n    data.category = category;\n\n    try {\n      const res = await fetch(\"/dashboard/requests/api\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n\n      let result;\n      try {\n        result = await res.json();\n      } catch (err) {\n        console.error(\"Failed to parse JSON:\", err);\n        addToast(\"Server returned invalid response\", \"error\");\n        return;\n      }\n\n      if (result.success) {\n        addToast(\"Request created successfully!\", \"success\");\n        router.push(\"/dashboard/requests\");\n      } else {\n        addToast(result.message || \"Failed to create request\", \"error\");\n      }\n    } catch (err) {\n      console.error(\"Fetch failed:\", err);\n      addToast(\"Could not submit request. Check your network or server.\", \"error\");\n    }\n  };\n\n  return (\n    <div className=\"flex gap-8\">\n      <aside className=\"w-64 bg-gray-100 border border-gray-300 rounded-lg p-4\">\n        <h2 className=\"text-lg font-semibold text-gray-700 mb-4\">Categories</h2>\n        <select\n          name=\"category\"\n          className=\"w-full border border-gray-400 rounded px-3 py-2 cursor-pointer\"\n          value={category}\n          onChange={(e) => setCategory(e.target.value as Category)}\n        >\n          <option value=\"\">Select Category</option>\n          <option value=\"network\">Network</option>\n          <option value=\"carpentry\">Carpentry</option>\n          <option value=\"hardware\">Hardware</option>\n          <option value=\"vehicle\">Vehicle</option>\n          <option value=\"supplies\">Supplies</option>\n        </select>\n      </aside>\n\n      <section className=\"flex-1 bg-white border border-gray-300 rounded-lg p-6\">\n        <h1 className=\"text-2xl font-semibold text-gray-800 mb-6\">\n          Create Service Request\n        </h1>\n\n        {category ? (\n          <form className=\"space-y-4\" onSubmit={handleSubmit}>\n            <Input\n              name=\"title\"\n              label=\"Request Title\"\n              error={errors.title}\n            />\n            <Textarea\n              name=\"description\"\n              label=\"Problem Description\"\n              error={errors.description}\n            />\n            <Input\n              name=\"requester\"\n              label=\"Requester Name\"\n              error={errors.requester}\n            />\n            <Input\n              name=\"department\"\n              label=\"Department / Office\"\n              error={errors.department}\n            />\n            <Input\n              name=\"contact\"\n              label=\"Contact Number\"\n              error={errors.contact}\n              onPhoneInput={true}\n            />\n            <Select\n              name=\"priority\"\n              label=\"Priority\"\n              options={[\"Low\", \"Medium\", \"High\"]}\n            />\n            <Input\n              name=\"date\"\n              label=\"Date Needed\"\n              type=\"date\"\n              error={errors.date}\n            />\n\n            {category === \"network\" && (\n              <>\n                <Select\n                  name=\"issueType\"\n                  label=\"Network Issue Type\"\n                  options={[\"No Internet\", \"Slow Connection\", \"Intermittent\"]}\n                />\n                <Input\n                  name=\"location\"\n                  label=\"Location / Room Number\"\n                  error={errors.location}\n                />\n                <Input\n                  name=\"device\"\n                  label=\"Device Affected\"\n                  error={errors.device}\n                />\n                <Input\n                  name=\"ip\"\n                  label=\"IP Address (Optional)\"\n                  error={errors.ip}\n                />\n              </>\n            )}\n\n            <button\n              type=\"submit\"\n              className=\"bg-gray-800 text-white px-6 py-2 rounded hover:bg-black transition cursor-pointer\"\n            >\n              Submit Request\n            </button>\n          </form>\n        ) : (\n          <p className=\"text-gray-500\">\n            Please select a category to load the form.\n          </p>\n        )}\n      </section>\n    </div>\n  );\n}\n\n/* ---------------- REUSABLE COMPONENTS ---------------- */\ntype InputProps = {\n  label: string;\n  type?: string;\n  name: string;\n  error?: string;\n  onPhoneInput?: boolean;\n};\n\nfunction Input({\n  label,\n  type = \"text\",\n  name,\n  error,\n  onPhoneInput = false,\n}: InputProps) {\n  const inputType = getFieldInputType(name) || type;\n  const pattern = getFieldPattern(name);\n\n  const handlePhoneInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (onPhoneInput) {\n      e.target.value = filterPhoneInput(e.target.value);\n    }\n  };\n\n  return (\n    <div>\n      <label className=\"block text-gray-600 mb-1\">{label}</label>\n      <input\n        name={name}\n        type={inputType}\n        pattern={pattern}\n        onChange={handlePhoneInput}\n        className={`w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 ${\n          error\n            ? \"border-red-500 focus:ring-red-500\"\n            : \"focus:ring-gray-800\"\n        }`}\n        title={\n          inputType === \"tel\"\n            ? \"Phone number can only contain numbers, dashes, parentheses, plus sign, and spaces\"\n            : \"\"\n        }\n      />\n      {error && <p className=\"text-red-500 text-sm mt-1\">{error}</p>}\n    </div>\n  );\n}\n\ntype TextareaProps = {\n  label: string;\n  name: string;\n  error?: string;\n};\n\nfunction Textarea({ label, name, error }: TextareaProps) {\n  return (\n    <div>\n      <label className=\"block text-gray-600 mb-1\">{label}</label>\n      <textarea\n        name={name}\n        rows={3}\n        className={`w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 ${\n          error\n            ? \"border-red-500 focus:ring-red-500\"\n            : \"focus:ring-gray-800\"\n        }`}\n      />\n      {error && <p className=\"text-red-500 text-sm mt-1\">{error}</p>}\n    </div>\n  );\n}\n\ntype SelectProps = { label: string; options: string[]; name: string };\n\nfunction Select({ label, options, name }: SelectProps) {\n  return (\n    <div>\n      <label className=\"block text-gray-600 mb-1\">{label}</label>\n      <select\n        name={name}\n        className=\"w-full border rounded px-3 py-2 cursor-pointer focus:outline-none focus:ring-2 focus:ring-gray-800\"\n      >\n        <option value=\"\">Select</option>\n        {options.map((opt) => (\n          <option key={opt}>{opt}</option>\n        ))}\n      </select>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}